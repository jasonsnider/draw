var draw=function(){var e=document.querySelector("main"),t=e.offsetWidth,n=e.offsetHeight,r=document.createElement("canvas"),i=r.getContext("2d"),o=r.getBoundingClientRect(),l=0,a=0,s=0,d=0,c=0,h=0,u=!1,f=!1,y="",g=!1,w="",m="",k=[],S=0,p=[];return{setIsDrawing:function(e){g=e},getIsDrawing:function(){return g},getShape:function(){return y},setShape:function(e){y=e},randColor:function(){return"#"+Math.floor(16777215*Math.random()).toString(16)},setStrokeColor:function(e){w=e},setFillColor:function(e){m=e},getStrokeColor:function(){return 6<w.length?w:this.randColor()},getFillColor:function(){return 6<m.length?m:this.randColor()},setStart:function(){s=l,d=a},setEnd:function(){c=l,h=a},setPoint:function(){k[S]=[],k[S].x=l,k[S].y=a,2<k.length?(this.draw(),S=0,k=[]):S++},setXY:function(e){u=l,f=a,l=e.clientX-o.left-r.offsetLeft,a=e.clientY-o.top-r.offsetTop},writeXY:function(){document.getElementById("trackX").innerHTML="X: "+l,document.getElementById("trackY").innerHTML="Y: "+a},draw:function(){switch(i.restore(),y){case"rectangle":this.drawRect();break;case"line":this.drawLine();break;case"circle":this.drawCircle();break;case"path":this.drawPath();break;case"3-point":this.draw3Point();break;case"triangle":this.drawTriangle();break;default:alert("Please choose a shape")}i.save()},draw3Point:function(){i.fillStyle=this.getFillColor(),i.strokeStyle=this.getStrokeColor(),i.beginPath(),i.moveTo(k[0].x,k[0].y),i.lineTo(k[1].x,k[1].y),i.lineTo(k[2].x,k[2].y),i.lineTo(k[0].x,k[0].y),i.stroke(),i.fill(),p.push({shape:"3-point",cords:{points:k},styles:{stroke:i.strokeStyle,fill:i.fillStyle}})},drawPath:function(){i.strokeStyle=this.getStrokeColor(),i.beginPath(),i.moveTo(u,f),i.lineTo(l,a),i.stroke(),p.push({shape:"path",cords:{lx:u,ly:f,x:l,y:a},styles:{stroke:i.strokeStyle}})},drawCircle:function(){i.strokeStyle=this.getStrokeColor(),i.fillStyle=this.getFillColor();var e=s-c,t=d-h,n=Math.sqrt(e*e+t*t);i.beginPath(),i.arc(s,d,n,0,2*Math.PI),i.stroke(),i.fill(),p.push({shape:"circle",cords:{x1:s,y1:d,x2:c,y2:h},styles:{stroke:i.strokeStyle,fill:i.fillStyle}})},drawLine:function(){i.strokeStyle=this.getStrokeColor(),i.beginPath(),i.moveTo(s,d),i.lineTo(c,h),i.stroke(),p.push({shape:"line",cords:{x1:s,y1:d,x2:c,y2:h},styles:{stroke:i.strokeStyle}})},drawTriangle:function(){var e=s-c,t=d-h,n=Math.sqrt(e*e+t*t),r=s+n,o=d+n;c<s&&(r=s-n),h<d&&(o=d-n),i.fillStyle=this.getFillColor(),i.strokeStyle=this.getStrokeColor(),i.beginPath(),i.moveTo(s,d),i.lineTo(r,o),i.lineTo(c,h),i.lineTo(s,d),i.stroke(),i.fill(),p.push({shape:"triangle",cords:{x1:s,y1:d,x2:c,y2:h},styles:{stroke:i.strokeStyle,fill:i.fillStyle}})},drawRect:function(){i.fillStyle=this.getFillColor(),i.strokeStyle=this.getStrokeColor(),i.fillRect(s,d,c-s,h-d),p.push({shape:"rectangle",cords:{x1:s,y1:d,x2:c,y2:h},styles:{stroke:i.strokeStyle,fill:i.fillStyle}})},clear:function(){r.width=r.width},redraw:function(){for(item in p){switch(p[item].shape){case"path":y=p[item].shape,u=p[item].cords.lx,f=p[item].cords.ly,l=p[item].cords.x,a=p[item].cords.y,i.strokeStyle=p[item].styles.stroke;break;case"circle":case"line":case"rectangle":case"triangle":y=p[item].shape,s=p[item].cords.x1,d=p[item].cords.y1,c=p[item].cords.x2,h=p[item].cords.y2,i.fillStyle=p[item].styles.fill,i.strokeStyle=p[item].styles.stroke;break;case"3-point":y=p[item].shape,k=p[item].cords.points,i.strokeStyle=p[item].styles.stroke,i.fillStyle=p[item].styles.fill}this.draw()}},getCanvas:function(){return r},init:function(){r.width=t,r.height=n,e.appendChild(r)}}}();draw.init(),document.getElementById("btnRect").addEventListener("click",function(){draw.setShape("rectangle")}),document.getElementById("btnCircle").addEventListener("click",function(){draw.setShape("circle")}),document.getElementById("btnPath").addEventListener("click",function(){draw.setShape("path")}),document.getElementById("btnTriangle").addEventListener("click",function(){draw.setShape("triangle")}),document.getElementById("btnLine").addEventListener("click",function(){draw.setShape("line")}),document.getElementById("btn3Point").addEventListener("click",function(){draw.setShape("3-point")}),document.getElementById("btnClear").addEventListener("click",function(){confirm("Are you sure you want to clear the canvas?")&&draw.clear()}),document.getElementById("btnRedraw").addEventListener("click",function(){confirm("Are you sure you want to redraw the canvas?")&&draw.redraw()}),draw.getCanvas().addEventListener("mousedown",function(){"3-point"!==draw.getShape()&&(draw.setStart(),draw.setIsDrawing(!0))}),draw.getCanvas().addEventListener("mouseup",function(){"3-point"!==draw.getShape()&&(draw.setEnd(),draw.draw(),draw.setIsDrawing(!1)),"3-point"===draw.getShape()&&draw.setPoint()}),draw.getCanvas().addEventListener("mousemove",function(e){draw.setXY(e),draw.writeXY(),"path"===draw.getShape()&&!0===draw.getIsDrawing()&&draw.draw()}),document.getElementById("strokeColor").addEventListener("change",function(){draw.setStrokeColor(document.getElementById("strokeColor").value)}),document.getElementById("randStrokeColor").addEventListener("change",function(){draw.setStrokeColor("")}),document.getElementById("fillColor").addEventListener("change",function(){draw.setFillColor(document.getElementById("fillColor").value)}),document.getElementById("randFillColor").addEventListener("change",function(){draw.setFillColor("")});